{% extends "layout.html" %}

{% block content %}

{% if ruolo != 'capo' %}
<h2>{{ title }}</h2>
{% else %}
<h2>Profilo del boss</h2>
{% endif %}

<div class="container">

    <ul id="users">
        <li>
            <!--dati_utente � l'oggetto utente. Cio� come una scatola che contiene le info della
                persona loggata nel momento corrente'-->
            <span class="field-name">Utente:</span>
            <span class="field-value">{{ dati_utente['nome'] }}</span>
            <span class="field-value">{{ dati_utente['cognome'] }}</span>
        </li>
        <li>
            <span class="field-name">Email:</span>
            <span class="field-value">{{ dati_utente['email'] }}</span>
        </li>
        <li>
            <span class="field-name">Telefono:</span>
            <span class="field-value">{{ dati_utente['cellulare'] }}</span>
        </li>
    </ul>
    <hr />

    <!-- poteri del boss
        dropdown template preso da qui:http://localhost:56500/profilo#-->
    {% if ruolo == 'capo' %}

    <div class="dropdown">
        <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
            Menu Poteri Boss
        </a>

        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
            <li><a class="dropdown-item" href="/registrazione">ciao</a></li>
            <li><a href="{{ url_for('home') }}">Home</a></li>
            <li><a class="dropdown-item" href="#">qualcosa</a></li>
        </ul>
    </div>
    {% endif %}

    <!-- Tabella esempio in cui apparirebbero le prenotazioni attive
        del proprio profilo-->
    {% if ruolo != 'capo' %}
    <h2>Prenotazioni attive [ESEMPIO]</h2>
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Email</th>
                <th scope="col">Nome</th>
                <th scope="col">Cognome</th>
                <th scope="col">istruttore</th>

            </tr>
        </thead>
        <tbody>
            <!--qua vengono inseriti i dati relativi alle varie prenotazioni.
                appariranno in tabelle separate da una riga
                dati_richiesti � il contenitore dei dati che viene passata da views
                p serve a scorrerli e a stamparli-->
            {% for p in dati_richiesti %}
            <tr>
                <td>{{p.email}}</td>
                <td>{{p.nome}}</td>
                <td>{{p.cognome}}</td>
                <td>{{p.is_istruttore}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    {% if ruolo == 'capo' %}
    <h2> lista iscritti</h2>
    <!--ho commentato il form che era scritto prima perché i form non possono stare nelle tr
        Non dava problemi, perché comunque veniva renderizzato, però segnava comunque errore
        L'ho spostato fuori dalla tabella e collegato tutti gli input usando l'id del form
        e usando l'attributo "form" secondo quanto riportato qui:
        https://stackoverflow.com/questions/5967564/form-inside-a-table

        Non so se funziona perché non ho capito bene come viene gestito, quindi non
        ho apportato ulteriori modifiche-->
    <form action="/profilo" id="form_tabella" method="POST"></form>

    <table class="table">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Codice Fiscale</th>
                <th scope="col">Nome</th>
                <th scope="col">Cognome</th>
                <th scope="col">Telefono</th>
                <th scope="col">Istruttore</th>
                <th scope="col">Iscritto</th>
            </tr>
        </thead>
        <tbody>
            {% for row in lista_persone %}
            <tr>
                <td>{{ row['codice_fiscale'] }}</td>
                <td>{{ row['nome'] }}</td>
                <td>{{ row['cognome'] }}</td>
                <td>{{ row['cellulare'] }}</td>

                <!--<form action="/profilo" method="POST">-->
                <td>
                    <input type="radio" name="{{ row['codice_fiscale'] }}_radio" form="form_tabella" value="istruttore"
                           {% if row['ruolo']= =2 %} checked {% endif %}> istruttore
                </td>

                <td>
                    <input type="radio" name="{{ row['codice_fiscale'] }}_radio" form="form_tabella"
                           {% if row['ruolo']= =3 %} checked {% endif %} value="iscritto"> iscritto
                </td>
                <td>
                    <input type="hidden" name="id_passato" value="{{ row['codice_fiscale'] }}" form="form_tabella">
                </td>
                <td><input type="submit" name="modificavalori" class="btn btn-primary" form="form_tabella" value="ModificaPermessi"> </td>
                <!--</form>-->
            </tr>
            {% endfor %}
        </tbody>
    </table>

    </form>
    {% endif %}
</div>




    {% endblock %}
