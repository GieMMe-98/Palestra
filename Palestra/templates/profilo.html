{% extends "layout.html" %}

{% block content %}

{% if ruolo != 'capo' %}
<h2>{{ title }}</h2>
{% else %}
<h2>Profilo del boss</h2>
{% endif %}

<div class="container">

    <ul id="users">
        <li>
            <!--dati_utente � l'oggetto utente. Cio� come una scatola che contiene le info della
                persona loggata nel momento corrente'-->
            <span class="field-name">Utente:</span>
            <span class="field-value">{{ dati_utente['nome'] }}</span>
            <span class="field-value">{{ dati_utente['cognome'] }}</span>
        </li>
        <li>
            <span class="field-name">Email:</span>
            <span class="field-value">{{ dati_utente['email'] }}</span>
        </li>
        <li>
            <span class="field-name">Telefono:</span>
            <span class="field-value">{{ dati_utente['cellulare'] }}</span>
        </li>
    </ul>
    <hr />
</div>
    <!-- poteri del boss
        dropdown template preso da qui:http://localhost:56500/profilo#-->
    {% if ruolo == 'capo' %}

    <div>
        <h3>Poteri Del Capo (link provvisori)</h3> 
        <ul>
            <li><a href="{{ url_for('corsi') }}">corsi</a></li>
            <li><a href="{{ url_for('policy_occupazione') }}">Policy occupazione</a></li>
            <li><a href="{{ url_for('calendario') }}">Calendario</a></li>
        </ul>
    </div>
    {% endif %}

    <!-- Tabella esempio in cui apparirebbero le prenotazioni attive
        del proprio profilo-->
    {% if ruolo != 'capo' %}
    <h2>Prenotazioni attive [ESEMPIO]</h2>
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Email</th>
                <th scope="col">Nome</th>
                <th scope="col">Cognome</th>
                <th scope="col">istruttore</th>

            </tr>
        </thead>
        <tbody>
            <!--qua vengono inseriti i dati relativi alle varie prenotazioni.
                appariranno in tabelle separate da una riga
                dati_richiesti � il contenitore dei dati che viene passata da views
                p serve a scorrerli e a stamparli-->
            {% for p in dati_richiesti %}
            <tr>
                <td>{{p.email}}</td>
                <td>{{p.nome}}</td>
                <td>{{p.cognome}}</td>
                <td>{{p.is_istruttore}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    
    <h2> lista iscritti</h2>
    <!--ho commentato il form che era scritto prima perché i form non possono stare nelle tr
        Non dava problemi, perché comunque veniva renderizzato, però segnava comunque errore
        L'ho spostato fuori dalla tabella e collegato tutti gli input usando l'id del form
        e usando l'attributo "form" secondo quanto riportato qui:
        https://stackoverflow.com/questions/5967564/form-inside-a-table

        Non so se funziona perché non ho capito bene come viene gestito, quindi non
        ho apportato ulteriori modifiche-->
    <form action="/profilo" id="form_tabella" method="POST"></form>

    <table class="table">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Codice Fiscale</th>
                <th scope="col">Nome</th>
                <th scope="col">Cognome</th>
                <th scope="col">Telefono</th>
                <th scope="col">Istruttore</th>
                <th scope="col">Iscritto</th>
            </tr>
        </thead>
        <tbody>
            {% for row in lista_persone %}
            <tr>
                <td>{{ row['codice_fiscale'] }}</td>
                <td>{{ row['nome'] }}</td>
                <td>{{ row['cognome'] }}</td>
                <td>{{ row['cellulare'] }}</td>

                
                <td>
                    <input type="radio" name="{{ row['codice_fiscale'] }}_radio" form="form_tabella" value="istruttore"
                           {% if row['ruolo']==2 %} checked {% endif %}> istruttore
                </td>

                <td>
                    <input type="radio" name="{{ row['codice_fiscale'] }}_radio" form="form_tabella"
                           {% if row['ruolo']==3 %} checked {% endif %} value="iscritto"> iscritto
                </td>
                <td>
                    <input type="hidden" name="id_passato" value="{{ row['codice_fiscale'] }}" form="form_tabella">
                </td>
                <td><input type="submit" name="modificavalori" class="btn btn-primary" form="form_tabella" value="ModificaPermessi"> </td>
                
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h5>Prenotazioni effettuate : </h5>
    <table class="table">
        <th>Data</th> <th>Sala</th> <th>Dalle</th><th>Alle</th> <th>Codice Prenotazione</th>
            {% for row in prenotazioni_effettuate %}
                <tr>
                    <td>{{row['data']}}</td><td>{{row['id_sala']}}</td><td>{{row['inizio']}}</td><td>{{row['fine']}}</td> <td> {{row['codice_prenotazione']}} </td>
                    <td>
                        <!-- L'ide lo segna in rosso ma non da problemi -->
                       <input type="button" class="btn btn-primary" onClick="apriDialog( {{ row['codice_prenotazione'] }} )" value='Cancella' > 
                        
                        
                    </td>
                </tr>
            {% endfor %}
        
    </table>

    <script>
         function apriDialog(savedValue){
             console.log(savedValue)
            var dialog = document.createElement("dialog")
            dialog.style.left ="50%"
            dialog.style.top = "50%"
           dialog.style.transform = "translate(-50%,-50%)"
           dialog.style.borderRadius = "5%"
           
            var p = document.createElement('p')
            p.innerHTML = "Sei sicuro di voler cancellare la prenotazione?"
            dialog.appendChild(p)
            var f = document.createElement("form")
            f.setAttribute("action", "/profilo")
            f.setAttribute("method", "post")
            
            var b_hidden = document.createElement('input')
            b_hidden.setAttribute("type","hidden")
            b_hidden.setAttribute("name","id_prenotazione_key")
            b_hidden.setAttribute("value",savedValue)

            var b_conferma = document.createElement('input')
            b_conferma.setAttribute("type","submit")
            b_conferma.setAttribute("name","Conferma")
            b_conferma.setAttribute("value","Conferma Cancellazione")
            b_conferma.setAttribute("class", "btn btn-primary")
            var b_annulla = document.createElement('input')
            b_annulla.setAttribute("type","button")
            b_annulla.setAttribute("value", "Annulla" )
            b_annulla.setAttribute("class", "btn btn-primary")
            b_annulla.addEventListener("click" ,function(){
                dialog.close()
            })
            
            
            f.appendChild(b_annulla)
            f.appendChild(b_hidden)
            f.appendChild(b_conferma)
            dialog.appendChild(f)
            var body = document.getElementsByTagName("body")
            body[0].appendChild(dialog)
            dialog.show()
            
            return
        }

    </script>


    {% if tab_corsi_creati %}
    <h5> Corsi creati :</h5>
    <table class="table">
        {% for row in tab_corsi_creati %}
            <tr>     
                <td>{{ row['data'] }}</td><td>{{ row['id_corso'] }}</td><td>{{ row['inizio'] }}</td><td>{{ row['fine'] }}</td><td>{{ row['nome_corso'] }}</td><td>{{ row['nome_tipologia'] }}</td>
            </tr>
        {% endfor %}
    </table>
    {% endif %}
  
    

    {% endblock %}
